- content_for :title, @player.name
.player
  %h1= @player.display_name
  .avatar
    = player_avatar @player
    = link_to 'change photo', '#', onclick: "$('.change_photo').toggle()"
    .change_photo
      = form_for @player, :url => { :action => "update" }, :html => {:class => "avatar_form"} do |f|
        = f.file_field :avatar
        = f.submit "update"
    .clearfix
    %h5 Average games per day
    %p= number_to_human @average_games_per_day, significant: 2

  .player_stats
    .player_stat.wins
      %h1 wins
      %h1= @player.winning_matches.count
    .player_stat.losses
      %h1 losses
      %h1= @player.losing_matches.count
    .clearfix
    %hr
    .badges
      %h5 Achievements
      - @player.achievements.each do |achievement|
        = link_to '#', rel: 'popover', data: {title: "#{achievement.title} - #{achievement.created_at.strftime('%Y-%m-%d')}", content: achievement.description, trigger: 'hover'} do
          %i{class: achievement.badge}
      .clearfix
    %hr
    .odds
      %h5 What are your odds of beating this person?
      = select_tag :players, options_from_collection_for_select(Player.all, "id", "name"), prompt: "Select a Player"
      %h3#calculator -
  .clearfix
  %hr
  %h2 Rank History
  #rank_history.stat
  %hr
  %h2 Match History
  %table
    %tr
      %th.date Date
      %th Winner
      %th Loser
      %th.action Action
    - @matches.each do |match|
      %tr{class: cycle("even", "odd")}
        %td.date= match.occured_at.strftime("%Y-%m-%d")
        %td= match.winner.display_name
        %td= match.loser.display_name
        %td.action= link_to "https://twitter.com/share", 'Brag', class: "twitter-share-button", data: {lang: "en", count: "none", text: "#{match.winner.display_name} just beat #{match.loser.display_name} in a vigorous game of SC Pong", url: match_url(match)}

  .back= link_to "Back", root_url

- if @achievement
  .modal.fade
    .modal-header
      %button.close{data: {dismiss: "modal"}}
        &times;
      %h4
        Achievement unlocked!
    .modal-body
      %table.table
        %thead
          %tr
            %th= @player.display_name
        %tbody
          %tr
            %td
              .badge-wrap
                .badge-large
                  %i{class: @achievement.badge}
                .badge-wrap-right
                  %strong.badge-title= @achievement.title
                  .badge-description= @achievement.description
  :javascript
    $(function() {
      $(".modal").modal();
      setTimeout(function() {
        $(".modal").modal('hide');
      }, 8000);
    });
    
%table#data
  %tfoot
    %tr
      %th 1
      %th 2
      %th 3
      %th 4
      %th 5
      %th 6
      %th 7
      %th 8
      %th 9
      %th 10
      %th 11
      %th 12
      %th 13
      %th 14
      %th 15
      %th 16
      %th 17
      %th 18
      %th 19
      %th 19
      %th 20
      %th 22
      %th 23
      %th 24
      %th 25
      %th 26
      %th 27
      %th 28
      %th 29
      %th 30
      %th 31
  %tbody
    %tr
      %td 8
      %td 25
      %td 27
      %td 25
      %td 54
      %td 59
      %td 79
      %td 47
      %td 27
      %td 44
      %td 44
      %td 51
      %td 56
      %td 83
      %td 12
      %td 91
      %td 52
      %td 12
      %td 40
      %td 8
      %td 60
      %td 29
      %td 7
      %td 33
      %td 56
      %td 25
      %td 1
      %td 78
      %td 70
      %td 68
      %td 2

= javascript_include_tag 'popup'
= javascript_include_tag 'analytics'
:javascript
  $("#players").on('change', function(e){
    $.ajax({url: '/players/odds',
            data: {
              player_id: #{@player.id},
              opponent_id: $(e.target).val() },
            type: 'GET'
            }).done(function(data){
              $('#calculator').html(parseFloat(data).toFixed(2) + '%');
            });
  });
  $('document').ready(function(){
    graphMyShiz(#{@rank_history_x},#{@rank_history_y});
  });
